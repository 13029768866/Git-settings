# 数组操作

## join

先从最简单的数组操作开始：

```
var array = ['a','b','c']
array.join('-') // 结果是 'a-b-c'
```

我们画一下内存图：



![内存分图](https://video.jirengu.com/FvlJHqXzE0BlF7S-jZDG9Gaxm4Hh)内存分图



1. array.join 实际上是 Array.prototype.join 对应的函数（array.join === Array.prototype.join === ADDR401）
2. array.join('-') 等价与 array.join.call(array, '-')
3. join 函数通过 this 和 arguments[0] 可以得到 array 和 '-' 两个值

所以我们可以大胆猜测 array.join 的源代码大概是这样的

```
Array.prototype.join = function(char){
  let result = this[0] || ''
  let length = this.length
  for(let i=1; i< length; i++){
      result += char + this[i]
  }
  return result
}
```

this 就是 array，因为你使用 array.join('-') 来调用 join 的（隐式指定this）

## slice

接下来研究第二个数组操作

```
array.slice(beginIndex, endIndex)
```

显而易猜，源码大概大概大概是这样的

```
Array.prototype.slice = function(begin, end){
    let result = []
    begin = begin || 0
    end = end || this.length
    for(let i = begin; i< end; i++){
        result.push(this[i])
    }
    return result
}
```

于是很多前端用 slice 来将伪数组，转化成数组

```
array = Array.prototye.slice.call(arrayLike)
或者
array = [].slice.call(arrayLike)
```

ES 6 看不下去这种蹩脚的转化方法，出了一个新的 API

```
array = Array.from(arrayLike)
```

专门用来将伪数组转化成真数组。

P.S. 伪数组与真数组的区别就是：伪数组的原型链中没有 Array.prototype，而真数组的原型链中有 Array.prototype。因此伪数组没有 pop、join 等属性。

## sort

我听说大部分的语言内置的 sort 方法都是快速排序算法。我们就简化成选择排序吧

```
Array.prototype.sort = function(fn){
    fn = fn || (a,b)=> a-b
    let roundCount = this.length - 1 // 比较的轮数
    for(let i = 0; i < roundCount; i++){
        let minIndex = this[i]
        for(let k = i+1; k < this.length; k++){
            if( fn.call(null, this[k],this[i]) < 0 ){
                [ this[i], this[k] ] = [ this[k], this[i] ]
            }
        }
    }
}
```

fn.call(null, this[k], this[i]) 决定了第 k 项和第 i 项的前后（大小）关系。

fn 为 (a,b) => a-b 表示啥？fn 为 (a,b) => b-a 又表示啥？

不重要，因为如果前者不符合你的需求，那么后者一定符合你的需求，你只需要试两边就知道用哪一个了。